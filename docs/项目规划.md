# AI写作工具项目规划文档

## 项目概述

本项目旨在开发一个基于AI的智能写作工具，利用LangChain或LangGraph框架实现。该工具将支持内容生成、编辑、模板管理、内容存储、上下文压缩和创意提示等功能，帮助用户高效地进行创作。

## 项目目标

开发一个功能完整的AI写作助手，具备以下核心能力：
1. AI生成作品大纲和内容
2. 内容编辑与管理
3. 提示词模板系统
4. 数据存储与管理
5. 上下文压缩与提炼
6. 创意提示生成

## 功能需求

### 1. AI内容生成模块
- **大纲生成**：根据用户输入的简单想法或主题，生成详细的作品大纲
- **内容生成**：基于大纲或章节标题，生成具体的内容段落
- **风格适配**：根据预设风格模板生成相应风格的内容

### 2. 内容编辑模块
- **富文本编辑器**：提供所见即所得的编辑体验
- **版本控制**：保存编辑历史，支持回滚到历史版本
- **分段编辑**：支持对大纲各章节进行独立编辑

### 3. 提示词模板系统
- **模板管理**：支持创建、编辑和删除提示词模板
- **风格预设**：预设多种文风（如古风、现代、科幻等）
- **动态替换**：模板中支持变量占位符，动态替换为实际内容

### 4. 数据存储模块
- **作品管理**：保存和管理用户的作品
- **数据库设计**：设计合理的数据库结构存储作品、章节、模板等信息
- **同步机制**：实时或定时同步编辑内容到数据库

### 5. 上下文压缩模块
- **内容提炼**：将长篇内容压缩为关键要点
- **风格保持**：确保压缩后仍能保持原始文风特征
- **上下文理解**：为AI提供有效的上下文信息

### 6. 创意提示模块
- **智能推荐**：根据当前内容提供相关创意建议
- **灵感生成**：基于已有内容生成新的创作方向
- **情节建议**：为故事类作品提供情节发展建议

### 7. 连贯性与风格管理
- **智能上下文摘要**：提取关键信息如人物关系、世界观设定、情节进展等
- **会话状态管理**：记录用户的创作进度和意图，确保AI理解当前创作状态
- **风格指纹提取**：从用户已编辑的内容中学习独特的文风特征
- **风格漂移检测**：监控AI生成内容与原作风格的偏差
- **一致性检查**：检测人物行为、设定是否前后一致
- **连贯性维护**：确保中断后继续创作时内容的连贯性

### 8. 作品结构管理
- **角色档案**：自动提取和维护作品中的人物信息
- **设定库**：世界观、背景设定的统一管理
- **进度可视化**：创作进度、字数统计、完成度等可视化展示
- **多阶段创作支持**：从构思、大纲、初稿到修改的全流程支持

## 技术架构

### AI框架选择
- **主要框架**：采用LangGraph作为主要框架，因为它更适合处理复杂的状态转换和多步骤工作流
- **辅助工具**：集成LangChain的组件用于提示词管理和模型调用

### 后端架构
- **API层**：使用FastAPI构建RESTful API
- **业务逻辑层**：处理AI生成、内容编辑、模板管理等核心逻辑
- **数据访问层**：封装数据库操作

### 数据库设计
- **作品表**：存储作品基本信息
- **章节表**：存储章节内容和结构
- **模板表**：存储提示词模板
- **版本历史表**：存储内容编辑历史
- **角色设定表**：存储作品角色信息
- **世界设定表**：存储世界观设定
- **会话状态表**：存储创作会话状态
- **用户表**：存储用户信息（如果需要用户系统）

### 前端架构
- **前端框架**：使用React或Vue.js构建用户界面
- **状态管理**：使用Redux或Vuex管理应用状态
- **编辑器**：集成富文本编辑器（如Draft.js或Quill.js）

## 详细功能设计

### 1. AI生成模块设计
```python
# 示例概念设计
class ContentGenerator:
    def generate_outline(self, theme: str, style_template: str) -> Outline:
        """根据主题生成大纲"""
        pass
    
    def generate_content(self, outline_item: OutlineItem, context: str, style_template: str) -> str:
        """根据大纲项目生成内容"""
        pass
    
    def compress_context(self, content: str) -> str:
        """压缩内容上下文"""
        pass
```
### 2. 模板系统设计
- 模板结构：包含提示词主体、变量占位符、参数配置
- 模板类型：
    - 风格模板：定义整体文风特征
    - 结构模板：定义内容结构
    - 场景模板：针对特定场景的模板
### 3. 数据模型设计
```sql
-- 作品表
CREATE TABLE works (
    id INT PRIMARY KEY,
    title VARCHAR(255),
    description TEXT,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- 章节表
CREATE TABLE chapters (
    id INT PRIMARY KEY,
    work_id INT,
    title VARCHAR(255),
    content TEXT,
    position INT,
    compressed_summary TEXT,
    FOREIGN KEY (work_id) REFERENCES works(id)
);

-- 角色设定表
CREATE TABLE characters (
    id INT PRIMARY KEY,
    work_id INT,
    name VARCHAR(255),
    description TEXT,
    traits TEXT,
    FOREIGN KEY (work_id) REFERENCES works(id)
);

-- 世界设定表
CREATE TABLE world_settings (
    id INT PRIMARY KEY,
    work_id INT,
    name VARCHAR(255),
    description TEXT,
    FOREIGN KEY (work_id) REFERENCES works(id)
);

-- 会话状态表
CREATE TABLE session_states (
    id INT PRIMARY KEY,
    work_id INT,
    user_id INT,
    session_data JSON,
    last_accessed TIMESTAMP,
    FOREIGN KEY (work_id) REFERENCES works(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

## 开发计划

### 第一阶段：基础架构搭建
- [ ] 环境配置与依赖安装
- [ ] 项目目录结构设计
- [ ] 数据库设计与初始化
- [ ] 基础API框架搭建
- [ ] LangGraph集成

### 第二阶段：核心AI功能开发
- [ ] AI内容生成模块开发
- [ ] 提示词模板系统实现
- [ ] 上下文压缩算法实现
- [ ] 创意提示功能开发

### 第三阶段：编辑与存储功能
- [ ] 内容编辑模块开发
- [ ] 数据存储与同步功能
- [ ] 版本历史管理
- [ ] 数据库操作优化

### 第四阶段：连贯性与风格管理
- [ ] 风格指纹提取算法实现
- [ ] 会话状态管理功能
- [ ] 一致性检查机制
- [ ] 角色与设定管理功能

### 第五阶段：用户界面开发
- [ ] 前端框架搭建
- [ ] 作品管理界面
- [ ] 编辑器界面开发
- [ ] 模板管理界面

### 第六阶段：测试与优化
- [ ] 单元测试编写
- [ ] 集成测试
- [ ] 性能优化
- [ ] 用户体验优化

## 扩展功能

### 未来可能添加的功能
1. **协作功能**：支持多人协作创作
2. **AI校对**：语法检查和风格统一性检查
3. **多语言支持**：支持多种语言的创作
4. **导出功能**：支持多种格式导出（PDF、Word、EPUB等）
5. **API接口**：开放API供第三方应用集成
6. **移动端适配**：响应式设计或独立移动应用
7. **情感与节奏控制**：分析作品的情感起伏，辅助创作节奏
8. **批注系统**：用户可以给AI生成的内容添加批注和修改建议
9. **创作日志**：记录创作过程中的思考和修改原因
10. **AI反馈学习**：AI可以根据用户的修改学习用户的偏好
11. **个性化工作区**：用户可以自定义创作流程和工具布局

## 技术选型

### 后端技术栈
- **Python**：主要开发语言
- **FastAPI**：Web框架
- **LangGraph**：AI应用框架
- **SQLAlchemy**：ORM框架
- **SQLite/PostgreSQL**：数据库

### 前端技术栈
- **React**：前端框架
- **TypeScript**：类型安全
- **Tailwind CSS**：样式框架
- **Draft.js**：富文本编辑器

### AI模型
- **大语言模型**：可选择GPT系列、Claude或其他开源模型
- **嵌入模型**：用于上下文理解和相似性计算

## 部署方案

### 本地部署
- 使用Docker容器化部署
- 支持一键启动所有服务

### 云端部署
- 支持部署到主流云平台
- 提供部署脚本和文档

## 风险评估

### 技术风险
- AI模型响应时间可能较长
- 高质量内容生成的稳定性问题
- 大文档处理的性能问题

### 应对措施
- 实现异步处理机制
- 添加缓存策略
- 优化数据库查询性能


## 技术选型（桌面应用版）

### 桌面应用框架
- **Electron**：使用Web技术（HTML, CSS, JavaScript）构建跨平台桌面应用
- **Tauri**：使用Rust作为后端，Web技术作为前端，更轻量级和安全
- **PyQt/PySide**：使用Python构建原生桌面应用，与AI后端集成更直接

### 后端架构调整
- **嵌入式服务器**：将FastAPI服务器嵌入桌面应用中
- **本地数据库**：使用SQLite作为本地存储，或可选的轻量级PostgreSQL
- **模型本地化**：考虑使用本地模型（如Ollama、llama.cpp）或云端API

### 前端技术栈
- **React**：如果选择Electron，可继续使用React
- **Vue.js**：轻量级选项，适合桌面应用
- **Svelte**：体积更小，性能更好
- **Tailwind CSS**：样式框架

### AI模型部署
- **本地模型选项**：
  - Ollama：本地运行大语言模型
  - llama.cpp：轻量级模型推理
  - Hugging Face Transformers：支持多种本地模型
- **云端模型选项**：
  - 继续使用API调用方式
  - 支持多种提供商（OpenAI、Anthropic、自建等）

### 桌面应用特定功能
- **离线支持**：本地存储和计算能力
- **文件系统集成**：直接访问用户文档
- **系统托盘**：快速访问和后台运行
- **本地搜索**：快速搜索本地作品
- **自动备份**：定期备份到云端或本地

### 性能优化
- **模型缓存**：缓存常用模型和计算结果
- **资源管理**：优化内存和CPU使用
- **异步处理**：确保UI响应性

### 安全考虑
- **沙盒机制**：限制应用权限
- **数据加密**：保护用户创作内容
- **API密钥管理**：安全存储第三方API密钥